{% extends "base.html" %}

{% block content %}
<div class="header" style="margin-bottom: 2rem;">
    <h1>Overview</h1>
    <p style="color: #666;">Welcome back, {{ session.get('name') }}</p>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="card stat-card">
        <h3>Total Staff</h3>
        <div class="stat-value">{{ stats.employees }}</div>
        <p>Active Employees</p>
    </div>
    <div class="card stat-card">
        <h3>Present Today</h3>
        <div class="stat-value" style="color: var(--success);">{{ stats.present }}</div>
        <p>Checked In</p>
    </div>
    <div class="card stat-card">
        <h3>Pending Leaves</h3>
        <div class="stat-value" style="color: var(--warning);">{{ stats.leaves }}</div>
        <p>Requests</p>
    </div>
</div>

<div class="row" style="display: flex; gap: 2rem; flex-wrap: wrap;">
    <!-- Actions -->
    <div class="col" style="flex: 1; min-width: 300px;">
        <div class="card quick-actions-card">
            <h3 style="margin-bottom: 1.5rem;">Quick Actions</h3>
            <div class="action-buttons">
                <a href="/attendance" class="btn btn-primary">Check In / Out</a>
                <a href="/leaves/new" class="btn btn-secondary"
                    style="border: 1px solid #ccc; background: white; color: #333;">Apply Leave</a>

                {% if session.get('role') == 'hr' %}
                <a href="/employees/new" class="btn btn-primary" style="background: var(--text-dark); border: none;">+
                    Add Member</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col" style="flex: 1.5; min-width: 300px;">
        <div class="card">
            <h3>Recent Activity</h3>
            <table class="table" style="margin-top: 0.5rem;">
                <thead>
                    <tr>
                        {% if session.get('role') == 'hr' %}<th>User</th>{% endif %}
                        <th>Action</th>
                        <th>Time / Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in activity %}
                    <tr>
                        {% if session.get('role') == 'hr' %}
                        <td><strong>{{ item.user_name }}</strong></td>
                        {% endif %}

                        <!-- Detect if it's attendance or log -->
                        {% if item.check_in is defined %}
                        <td>Check In</td>
                        <td>{{ item.check_in or '00:00' }}</td>
                        <td><span class="badge badge-success">Present</span></td>
                        {% else %}
                        <td>Log Entry</td>
                        <td>{{ item.date }}</td>
                        <td>-</td>
                        {% endif %}
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align:center; color:#999;">No recent activity today.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}